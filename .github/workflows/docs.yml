# reusable workflow の ドキュメントを生成する

name: Docs

on:
  pull_request:
    paths:
      - ".github/workflows/reusable-*.yml"
permissions:
  contents: write
defaults:
  run:
    shell: bash
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

# TODO: 更新されたファイルのみを対象にしたい
jobs:
  docs-lint:
    uses: ./.github/workflows/reusable-make-wf-docs.yml
    with:
      yaml-file: .github/workflows/reusable-lint.yml
      markdown-file: docs/reusable-lint.md
      ref: ${{ github.head_ref }}

  docs-make-wf-docs:
    uses: ./.github/workflows/reusable-make-wf-docs.yml
    with:
      yaml-file: .github/workflows/reusable-make-wf-docs.yml
      markdown-file: docs/reusable-make-wf-docs.md
      ref: ${{ github.head_ref }}

    # steps:
    #   - run: cat "${GITHUB_EVENT_PATH}"
    #   - name: Checkout
    #     uses: actions/checkout@v4
    #     with:
    #       ref: ${{ github.event.pull_request.head.ref }}

    #   - name: Inject document
    #     run: |
    #       docker run --rm -v "$(pwd):/work" -w "/work" \
    #       ghcr.io/tmknom/actdocs inject --sort \
    #       --file "${MD_FILE}" "${YAML_FILE}"

    #   - name: Push
    #     run: |
    #       if [[ "$(git status -s)" == "" ]]; then
    #         echo 'skipped'
    #         exit 0
    #       fi
    #       git config --global user.name "github-actions[bot]"
    #       git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
    #       git add "${MD_FILE}"
    #       git commit -m "Update ${MD_FILE}"
    #       git push
